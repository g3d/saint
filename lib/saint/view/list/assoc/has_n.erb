<% if http.xhr? -%>
    <script type="text/javascript" src="<%= Saint::FileServer["ui.js"] %>"></script>
<% end -%>

<% xhr = http.params['xhr']
   remote_node = @relation.remote_node
   @update_selector_url = http.route(:assoc__any__remote_items, @relation.id, @local_id, "/")
   if (items = @remote_items) && items.size > 0 %>

    <% if xhr.nil? && @attached == 0 && remote_node && filters = remote_node.saint.filters(http.params, :html) -%>
        <form action="<%= @update_selector_url %>0" id="saint_assoc_filters-<%= @relation.id %>">
          <input type="hidden" name="xhr" value="true"/>
          <%= filters %>
          <div class="inline topped">
            <div class="saint-filter_label">&nbsp;</div>
            <div class="btn-group">
              <a class="btn void-link"
                 onclick="Saint.submit_form('saint_assoc_filters-<%= @relation.id %>', '<%= @relation.id + @attached.to_s %>-partial');">
                <i class="icon-search"></i>
                Search</a>
              <a class="btn void-link"
                 onclick="Saint.update_container('<%= @relation.id + @attached.to_s %>-partial', '<%= @update_selector_url %>0?xhr=true');">
                Reset</a>
            </div>
          </div>
        </form>
    <% end -%>

    <div id="<%= '%s%s-partial' % [@relation.id, @attached.to_s] %>">
      <%= @pager.html %>
      <%= saint_view.render_partial('list/assoc/has_n-partial', items: items, level: 0, color: nil) %>
    </div>
<% end -%>
